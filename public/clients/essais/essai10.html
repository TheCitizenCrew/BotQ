<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="mobile-web-app-capable" content="yes" />
<title>Essai10</title>
<link href="/js/require.css" rel="stylesheet" type="text/css" />
</head>
<body>

<select id="serverurl">
	<option value="ws://html5rocks.websocket.org/echo">ws://html5rocks.websocket.org/echo</option>
	<option value="ws://echo.websocket.org" selected="selected">ws://echo.websocket.org</option>
</select>
<button id="talk">talk</button>

<div id="playground"></div>

<script src="/js/require.js"></script>
<script>
"use strict" ;

var connection ;

require(['jquery'], function($) {

	$('#serverurl').change(function(e){
		
		console.log('selected server : '+$('#serverurl').val());

		if( connection ){
			console.log('closing connection');
			connection.close();			
		}

		connection = new WebSocket( $('#serverurl').val() );

		// When the connection is open, send some data to the server
		connection.onopen = function () {
			connection.send('Ping'); // Send the message 'Ping' to the server
		};

		// Log errors
		connection.onerror = function (error) {
			println('WebSocket Error: ' + error);
		};

		// Log messages from the server
		connection.onmessage = function (e) {
			console.log(e);
			println('Server: ' + e.data);
		};
	});

	$('#talk').click(function(e){
		connection.send('itêžŒs time '+Date.now());
	});

	$('#serverurl').val('ws://echo.websocket.org');
	$('#serverurl').change();
	
});

function println(msg)
{
	console.log(msg);
	$('#playground').html( $('#playground').html() + "<p>"+msg+"</p>" );
}
</script>

</body>
</html>